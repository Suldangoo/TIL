# Chapter 06 : 메모리와 캐시 메모리

## RAM의 특징과 종류

- 주기억장치의 종류에는 크게 RAM과 ROM 두 가지가 있고, '메모리'는 보통 RAM을 지칭하는 경우가 많다.

### RAM의 특징
- RAM에는 실행할 프로그램의 명령어와 데이터가 저장된다.
- 중요한 것은, 전원을 끄면 RAM에 저장된 명령어와 데이터가 모두 날아간다는 것이다.
- 이렇게 전원을 끄면 저장된 내용이 사라지는 저장 장치를 **휘발성 저장 장치**라고 한다.
- 반면, 전원이 꺼져도 저장된 내용이 유지되는 저장 장치는 **비휘발성 저장 장치**라고 하며, 하드디스크나 SSD, USB등이 있다.
- CPU는 보조기억장치에 직접 접근하지 못해서, 보조기억장치엔 '보관할 대상'을 저장하고, RAM에는 '실행할 대상'을 저장한다.
- CPU가 실행하고 싶은 프로그램이 보조기억장치에 있다면, 이를 RAM으로 복사하여 저장한 뒤 실행한다.

### RAM의 용량과 성능
- RAM의 용량이 적다면 CPU에서 실행하고 싶은 프로그램을 자주 가져와야 해서 실행 시간이 길어진다.
- 하지만 RAM 용량이 충분하다면 보조기억장치에서 많은 데이터를 가져와 미리 저장하고, 프로그램을 동시에 실행하는 데 유리하다.
- 그렇다고 RAM이 필요 이상으로 용량이 커봤자 실행 속도가 그에 비례하여 빨라지지는 않는다.

### RAM의 종류
- RAM의 종류는 크게 DRAM, SRAM, SDRAM, DDR SDRAM이 있다.
- **DRAM**
  - Dynamic RAM의 준말로, 저장된 데이터가 **동적**으로 변하는(사라지는) RAM이다.
  - 즉, 시간이 지나면 저장된 데이터가 점차 사라지며, 데이터의 소멸을 막기 위해 일정 주기로 데이터를 재활성화해야 한다.
  - 이런 단점에도 소비 전력이 비교적 낮고, 저렴하고, 집적도가 높아 대용량 설계가 유리하여 일반적으로 사용하는 RAM이기도 하다.
- **SRAM**
  - Static RAM의 준말로, 저장된 데이터가 변하지 않는 RAM을 의미한다.
  - DRAM과 달리 시간이 지나도 데이터가 사라지지 않고, 재활성화할 필요도 없으며, 일반적으로 속도도 더 빠르다.
  - 그러나 DRAM보다 집적도가 낮고, 소비 전력도 크며, 가격이 더 비싸 일반적으로 사용되지 않는다.
  - 따라서 대용량으론 필요 없지만 속도는 빨라야하는 **캐시 메모리**에서 사용된다.
- **SDRAM**
  - Synchronous Dynamic RAM은 클럭 신호와 동기화된, 발전된 형태의 DRAM이다.
  - 클럭 타이밍에 맞춰 CPU와 정보를 주고받을 수 있음을 의미한다.
- **DDR SDRAM**
  - Double Data Rate SDRAM은 최근 가장 흔하게 사용되는 RAM이다.
  - 대역폭을 넓혀 속도를 빠르게 만든 SDRAM을 의미하며, **대역폭**이란 데이터를 주고받는 길의 너비를 의미한다.
  - DDR SDRAM은 일반 SDRAM과는 다르게 한 클럭당 두 번씩 CPU와 데이터를 주고받을 수 있다.
    - 이런 이유에서 한 클럭당 하나씩 데이터를 주고받을 수 있는 SDRAM을 **SDR(Single Data Rate) SDRAM**이라고도 한다.
    - DDR2 SDRAM은 DDR보다 대역폭이 두 배 넓은 SDRAM이다. 또 DDR3 SDRAM은 DDR2보다 대역폭이 두 배 넓은 SDRAM이다.
    - 가장 최근에 사용하는 메모리는 DDR4 SDRAM으로, SDR SDRAM보다 열 여섯배 넓은 대역폭을 가지고 있다.
  
## 메모리의 주소 공간

- 메모리에 저장된 정보의 위치는 주소로 나타낼 수 있다.
- 여기서 주소엔 물리 주소와 논리 주소로 두 종류가 존재한다.
  - **물리 주소**는 메모리 하드웨어가 사용하는 주소이다.
  - **논리 주소**는 CPU와 실행 중인 프로그램이 사용하는 주소이다.

### 물리 주소와 논리 주소

- 메모리가 사용하는 물리 주소는 말 그대로 정보가 실제로 저장된 하드웨어상의 주소를 의미한다.
- CPU와 실행 중인 프로그램이 사용하는 논리 주소는 실행 중인 프로그램 각각에게 부여된 0번지부터 시작되는 주소를 의미한다.
- 물리 주소가 실제 주소이며, 논리 주소는 프로그램 각각에게 주어진 개인의 주소이다.
- 그럼에도, CPU가 이해하는 주소는 논리 주소이나 실제로 메모리와 상호작용하려면 물리 주소를 사용해야 하기 때문에, 논리 주소와 물리 주소간의 변환이 이루어져야 한다.
- 논리 주소와 물리 주소 간의 변환은 CPU와 주소 버스 사이에 위치한 **메모리 관리 장치(MMU)**라는 하드웨어에 의해 수행된다.
- MMU는 CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더해 물리 주소로 변환한다.
  - 베이스 레지스터 값이 15000이고, CPU가 호출하는 논리 주소가 100이라면, 물리 주소 15100번지 값에 접근하게 된다.
  - 베이스 레지스터는 프로그램의 가장 시작점 물리 주소를 저장하고, 논리 주소는 시작점으로부터 떨어진 거리인 셈이다.
  
### 메모리 보호 기법

- 프로그램이 가지고 있는 논리 주소를 벗어난 영역을 지정하면 안된다.
  - 논리 주소가 0번지부터 999번지까지 있는 프로그램에 1500번지에 접근하려 하면, 영역이 넘쳐나 다른 프로그램에 접근하게 된다.
- 따라서 **한계 레지스터**가 논리 주소 범위를 벗어나는 명령어 실행을 방지하고, 다른 프로그램에 영향이 가지 않도록 보호합니다.
- 한계 레지스터는 논리 주소의 최대 크기를 저장한다.
  - 즉 프로그램 물리 주소 범위는 베이스 레지스터 값 이상, 베이스 레지스터 값 + 한계 레지스터 값 미만이 된다.
- CPU는 메모리에 접근하기 전에, 접근하고자 하는 논리 주소가 한계 레지스터보다 작은지를 항상 검사한다.
- CPU가 한계 레지스터보다 높은 논리 주소에 접근하려고 하면, 인터럽트(트랩)를 발생시켜 실행을 중단한다.

## 캐시 메모리

- CPU는 메모리에 저장된 데이터를 빈번하게 사용하지만, CPU 연산 시간보다 메모리 접근 시간이 더 느리다.
- CPU가 빠르게 연산해도 메모리 접근 시간이 느리면 빠른 연산 속도는 쓸모가 없으므로, 여기서 **캐시 메모리**를 사용한다.

### 저장 장치 계층 구조

- **빠른 저장 장치**와 **용량이 큰 저장 장치**는 양립하기 어렵다.
- CPU와 가까운 저장 장치는 빠르고, 멀리 있는 저장 장치는 느리다.
- 속도가 빠른 저장 장치는 저장 용량이 적고, 가격이 비싸다.
- 하나의 저장 장치만을 사용하면 그 단점이 명확하기 때문에, 컴퓨터는 다양한 저장 장치를 모두 사용하여 효율적으로 작업을 수행한다.
- 컴퓨터가 사용하는 저장 장치들을 CPU에 얼마나 가까운가를 기준으로 계층적으로 나타낸 것이 **저장 장치 계층 구조(Memory Hierarchy)**이다.
- 일반적인 저장 장치 계층 구조
  - 레지스터
  - 캐시 메모리
  - 메모리
  - 보조기억장치
  
### 캐시 메모리

- 캐시 메모리는 메모리 접근이 비교적 느리다는 점을 극복하기 위해, CPU와 메모리 사이에 위치하며 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치이다.
- CPU의 연산 속도와 메모리 접근 속도의 차이를 조금이나마 줄이기 위해 탄생했다.
- 컴퓨터 내부에는 여러 개의 캐시 메모리가 있으며, CPU와 가까운 순서대로 계층을 구성한다.
  - 코어와 가장 가까운 캐시 메모리를 L1(Level 1)캐시, 그 다음 가까운 캐시 메모리를 L2, L3라고 부른다.
  - 일반적으로 L1, L2캐시는 코어 내부에, L3는 코어 외부에 위치해있다.
  - 속도는 L1이 빠르며, L1이 제일 비싸고, L3가 용량이 제일 크다.
  - L1와 L2는 코어마다 고유하게 가지고 있으며, L3 캐시는 여러 코어가 공유하는 형태이다.
- 코어와 가장 가까운 L1캐시는 조금이라도 더 빠르게 만들기 위해, 명령어만을 저장하는 L1I캐시와 데이터만을 저장하는 L1D캐시로 분리하는 경우도 있는데, 이를 **분리형 캐시**라고 한다.

### 참조 지역성 원리