# Chapter 07 : 보조기억장치

## 다양한 보조기억장치

- 가장 대중적인 보조기억장치엔 하드 디스크, 플래시 메모리(USB, SD카드, SSD)가 있다.

### 하드 디스크

- 하드 디스크는 자기적인 방식으로 데이터를 저장하는 보조기억장치이다.
- 이 때문에 하드 디스크를 **자기 디스크**(Magnetic Disk)의 일종으로 보기도 한다.
- 하드 디스크에 실질적으로 데이터가 저장되는 곳은 원판인 **플래터**이다.
  - 플래터는 자기 물질로 덮여 있어 수많은 N극, S극을 저장하고, 각각 0과 1의 역할을 수행한다.
- 플래터를 회전시키는 구성 요소를 **스핀들**이라고 한다. 스핀들이 플래터를 돌리는 속도는 분당 회전수인 **RPM**단위로 표현된다.
- 플래터를 대상으로 데이터를 읽고 쓰는 침을 **헤드**라고 한다. 플래터 위에 미세하게 떠 바늘같이 생겼다.
- 헤드는 원하는 위치로 헤드를 이동시키는 **디스크 암**에 부착되어 있다.
- 플래터는 일반적으로 여러 겹으로 이루어져있고, 플래터 양면을 모두 사용할 수 있다. 양면 플래터를 사용하면 위아래로 플래터당 두 개의 헤드가 사용된다. 이 때 모든 헤드는 디스크 암에 부착되어 다같이 이동한다.

- 플래터는 **트랙**과 **섹터**라는 단위로 데이터를 저장한다.
  - 플래터를 여러 동심원으로 나누었을 때 그 중 하나의 원을 트랙이라고 한다. (운동장 달리기 트랙과도 같다)
  - 트랙이 피자 조각처럼 여러 조각으로 나뉘는데, 그 한 조각을 섹터라고 한다.
- 섹터는 하드 디스크의 가장 작은 전송 단위이다. 하나의 섹터는 일반적으로 512바이트 정도이나, 4096바이트까지 차이가 나기도 한다.
- 하나 이상의 섹터를 묶어 **블록**이라고 표현하기도 한다.
- 여러 겹의 플래터 상에서 같은 트랙이 위치한 곳을 모아 연결한 논리적 단위를 **실린더**라고 한다.
  - 여러 플래터의 동일한 위치에 있는 트랙들의 모음이다.
  - 연속된 정보는 보통 한 실린더에 기록된다. 그래야 디스크 암을 움직이지 않고 바로 연관 데이터에 접근할 수 있기 때문이다.
- 하드 디스크가 저장된 데이터에 접근하는 시간은 크게 탐색 시간, 회전 지연, 전송 시간으로 나뉜다.
  - **탐색 시간**은 접근하려는 데이터가 저장된 트랙까지 헤드를 이동시키는 시간을 의미한다.
  - **회전 지연**은 헤드가 있는 곳으로 플래터를 회전시키는 시간을 의미한다.
  - **전송 시간**은 하드 디스크와 컴퓨터 간에 데이터를 전송하는 시간을 의미한다.
- 하드 디스크에 다량의 데이터를 탐색하고 읽어 들이는 시간은 어마어마하게 걸린다.
- 탐색 시간과 회전 지연을 단축시키기 위해, RPM을 높이거나 참조 지역성에 입각해 헤드를 조금만 옮겨도 접근할 수 있도록 설계하는 것도 중요하다.
- 플래터에 하나의 헤드가 달려 앞뒤로 헤드를 이동시키는 방식을 **단일 헤드 디스크**(이동 헤드 디스크)라고 한다.
- 플래터의 트랙별로 헤드가 여러 개 달려 이동할 필요가 없는 방식을 **다중 헤드 디스크**(고정 헤드 디스크)라고 한다.

### 플래시 메모리

- 플래시 메모리는 전기적으로 데이터를 읽고 쓸 수 있는 반도체 기반의 저장 장치이다.
- 플래시 메모리는 보조기억장치 범주에만 속한다기보다, ROM이나 전자제품 기억 장치로도 널리 사용된다.
- 플래시 메모리에는 크게 **NAND 플래시 메모리**와 **NOR 플래시 메모리**가 있는데, 각각 NAND 연산을 수행하는 회로와 NOR 연산을 수행하는 회로를 기반으로 만들어진 메모리를 의미한다. 보통 대용량 저장 장치, 보조기억장치로 많이 사용되는 쪽은 NAND 플래시 메모리이다.
- 플래시 메모리에서 데이터를 저장하는 가장 작은 단위는 **셀**(Cell)이다.
- 이 셀이 모이고 모여 MG, GB, TB 용량을 갖는 저장 장치가 되는 것이다.
  - 한 셀에 1비트를 저장할 수 있는 플래시 메모리는 **SLC**(Single Level Cell)타입
  - 한 셀에 2비트를 저장할 수 있는 플래시 메모리는 **MLC**(Multiple Level Cell)타입
  - 한 셀에 3비트를 저장할 수 있는 플래시 메모리는 **TLC**(Tirple Level Cell)타입
- SLC타입은 한 셀에 1비트만 저장이 가능해 두 개의 정보를 표현 가능하며, MLC나 TLC타입에 비해 비트의 빠른 입출력이 가능하며, 수명도 비교적 길다. 하지만 용량 대비 가격이 높아 고성능 빠른 저장 장치에 사용된다.
- MLC타입은 한 셀에 2비트만 저장이 가능해 네 개의 정보를 표현 가능하며, SLC보다 속도와 수명은 떨어지지만 SLC보다 대용화하기 유리하다. 또한 비교적 용량 대비 가격이 저렴하다.
- TLC타입은 한 셀에 3비트만 저장이 가능해 여덟 개의 정보를 표현 가능하며, 대용량화가 매우 유리하고 SLC, MLC보다 수명과 속도가 떨어지지만 용량 대비 가격이 매우 저렴하다.
- 셀들이 모여 만들어진 단위를 **페이지**(Page), 페이지가 모여 만들어진 단위를 **블록**(Block), 블록이 모여 **플레인**(Plane), 플레인이 모여 **다이**(Die)가 된다.
  - 읽기와 쓰기는 **페이지 단위**로 이루어진다.
  - 삭제는 **블록 단위**로 이루어진다.
  - 즉, 읽기/쓰기 단위와 삭제 단위가 다르다.
- 페이지는 세 개의 상태를 가질 수 있다.
  - **Free 상태**는 어떠한 데이터도 저장하고 있지 않아, 새로운 데이터를 저장할 수 있는 상태를 의미한다.
  - **Valid 상태**는 이미 유효한 데이터를 저장하고 있는 상태를 의미한다.
  - **Invalid 상태**는 쓰레기값 등의 유효하지 않은 데이터를 저장하고 있는 상태를 의미한다.
- 플래시 메모리는 하드 디스크와 달리 덮어쓰기가 불가능해 Valid상태의 페이지엔 새 데이터를 저장할 수 없다.
- 기존 데이터를 다른 데이터로 수정하면, 한 블록에 존재하는 Free상태의 페이지에 새 데이터가 쓰이며 기존 수정될 데이터는 Invalid 상태가 된다.
  - 단, 이 경우 쓰레기값을 저장하고 있어 용량 낭비가 발생한다. 그렇다고 Invalid상태의 페이지만 삭제할 수도 없다.(삭제는 블록 단위로 이루어지기 때문)
  - 이런 쓰레기값을 정리하기 위해 **가비지 컬렉션**(Garbage Collection) 기능이 있다.
  - 가비지 컬렉션은 유효한 페이지만을 새로운 블록으로 복사한 뒤, 기존 블록을 삭제하는 기능이다.

## RAID의 정의와 종류

- 4TB 하드 디스크 한 개를 사용하는 것 보다, 1TB 하드 디스크 네 개로 RAID를 구성하는 것이 더 성능과 안정성이 뛰어나다.

### RAID의 정의

- **RAID**(Redundant Array of Independent Disks)는 하드 디스크와 SSD를 사용하는 기술로, 데이터의 안정성 혹은 높은 성능을 위해 여러 개의 물리적 보조기억장치를 마치 하나의 논리적 보조기억장치처럼 사용하는 기술을 의미한다.

### RAID의 종류

- RAID를 구성하는 방법은 여러가지가 있다.
- RAID 구성 방법을 **RAID 레벨**이라 표현하는데, 대표적으로 RAID 0, RAID 1, RAID 3, RAID 4, RAID 5, RAID 6이 있다.
- 그로부터 파생된 RAID 10, RAID 50 등도 존재한다.
- **RAID 0**
  - 여러 개의 보조기억장치에 데이터를 단순히 나누어 저장하는 구성 방식이다.
  - 저장되는 데이터는 각 하드 디스크에 번갈아 가며 데이터를 저장한다. 즉, 저장되는 데이터가 하드 디스크 개수만큼 나뉘어 저장되는 것이다.
  - 이를 줄무늬처럼 분산되기 때문에 **스트라입**(Stripe)이라 하고, 분산 저장하는 작업을 **스트라이핑**(Striping)이라고 한다.
  - 스트라이핑되면 저장된 데이터를 읽고 쓰는 속도가 빨라진다. 여러 번에 걸쳐 읽고 썼을 데이터를 동시에 읽고 쓸 수 있기 때문이다.
  - 그러나, RAID 0으로 저장된 정보는 안전하지 않다는 단점이 있다. 하드 디스크 중 하나에 문제가 생기면, 다른 모든 하드 디스크의 정보를 읽을 수 없게 되어버린다. 그래서 등장한 것이 RAID 1이다.
- **RAID 1**
  - 복사본을 만드는 방식이다. 거울처럼 완전한 복사본을 만드는 구성이라 **미러링**(Mirroring)이라고도 부른다.
  - 똑같은 내용을 저장하기 때문에 RAID 0보다 쓰기 속도가 느리고, 저장하려는 데이터도 같은 용량에서 두 배 적다.
  - 복구가 매우 간단하다는 장점이 있지만, 하드 디스크 개수가 한정되었을 때 사용 가능한 용량이 적어지는 단점이 있다.
- **RAID 4**
  - RAID 1처럼 완전한 복사본을 만드는 대신, 오류를 검출하고 복구하기 위한 정보를 저장하는 장치를 두는 구성 방식이다.
  - '오류를 검출하고 복구하기 위한 정보'를 **패리티 비트**(Parity Bit)라고 한다.
  - 패리티를 저장한 장치를 이용해 다른 장치의 오류를 검출하고, 오류가 있다면 복구한다.
    - 패리티 비트는 본래 오류 검출용 정보이며 오류 복구는 불가능하지만, RAID에선 오류 복구도 가능하다.
- **RAID 5**
  - RAID 4에선 어떤 새로운 데이터가 저장될 때마다 패리티를 저장하는 하드 디스크에 매번 데이터를 쓰기 때문에 병목 현상이 발생하는 단점이 있다.
  - RAID 5는 패리티 정보를 분산하여 저장하는 방식이다. 즉, 데이터를 저장하는 하드 디스크와 패리티를 저장하는 하드 디스크를 굳이 나누지 않고 하드 디스크마다 패리티를 저장하도록 하여 병목 현상을 해소하는 방식이다.
- **RAID 6**
  - 기본적으로 RAID 5와 같으나, 서로 다른 두 개의 패리티를 두는 방식이다.
    - 같은 종류의 패리티 비트를 하드 디스크 A, B에 각각 저장하여 하나가 손상되어도 다른 패리티를 쓸 수 있도록 하는 방식이다.
  - 오류를 검출하고 복구할 수 있는 수단이 두 개가 생겨 보다 안전한 방식이다.
  - 단, 데이터를 저장할 때마다 패리티를 두 번 써야하므로 속도는 비교적 느려, 안전하게 보관하고 싶을 때 사용하는 방식이다.
- 이외에도 RIAD 0과 1을 혼합한 RAID 10방식과, RAID 0과 5를 혼합한 RAID 50방식도 존재한다.
- 이렇게 여러 RAID 레벨을 혼합한 방식을 **Nested RAID**라고 한다.
- 각 RAID 레벨마다 장단점이 존재하므로, 무조건 어느게 좋다보다는 여러 상황마다 최적화된 방식을 선택하는 것이 중요하다.